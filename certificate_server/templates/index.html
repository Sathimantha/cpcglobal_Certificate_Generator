<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (head content remains the same) ... -->
</head>
<body>
    <!-- ... (body content remains the same) ... -->

    <script>
        let currentPersonData = null;

        function searchPerson() {
            // ... (searchPerson function remains the same) ...
        }

        function generateCertificate() {
            if (!currentPersonData) {
                alert("No person data available. Please search for a person first.");
                return;
            }

            fetch('/api/generate_certificate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(currentPersonData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Error: ${data.error}`);
                } else {
                    alert('Certificate generated successfully!');
                    window.open(`/api/certificate/${currentPersonData.student_id}`, '_blank');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while generating the certificate.');
            });
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('personInfo').innerHTML = '';
            document.getElementById('confirmationSection').style.display = 'none';
            currentPersonData = null;
        }
    </script>
</body>
</html>